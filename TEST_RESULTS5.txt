> challenge-backend@0.0.1 test:e2e
> jest --config ./test/jest-e2e.json

 FAIL  test/auth.e2e-spec.ts (20.033 s)
  ● Console

    console.log
      log users [
        {
          id: '2edf6dc8-6d03-4634-b3eb-813f6ebe8fb2',
          email: 'userB@example.com',
          password: '$2b$10$7GHlvzmi2FaRt69FtalTXOfvtiikwMfyNiuSaEJpE9tlhlNCtK.Rm',
          name: 'User B',
          birth: 1995-05-05T00:00:00.000Z,
          createdAt: 2026-02-07T11:18:21.504Z,
          updatedAt: 2026-02-07T11:18:21.504Z
        },
        {
          id: 'a4e3feb6-6c81-44e2-94c2-d457b58b4a95',
          email: 'test@example.com',
          password: '$2b$10$QaIZRiu.oQoyFDOwMfkxd.uQigPCzipw8QUnHhS9aN5mQ9Z8YBr.W',
          name: 'Test User',
          birth: 2000-01-01T00:00:00.000Z,
          createdAt: 2026-02-07T11:18:21.641Z,
          updatedAt: 2026-02-07T11:18:21.641Z
        }
      ]

      at Object.<anonymous> (auth.e2e-spec.ts:51:15)

  ● AuthModule (e2e) › POST /api/auth/register › [Gagal] Mendaftar dengan email yang sudah ada.

    expect(received).toBe(expected) // Object.is equality

    Expected: 409
    Received: 201

      53 |       const response = await registerUser(app, registerUserDto); // Second registration with same email
      54 |
    > 55 |       expect(response.status).toBe(409);
         |                               ^
      56 |       expect(response.body.message).toBe('Email already exists');
      57 |     });
      58 |

      at Object.<anonymous> (auth.e2e-spec.ts:55:31)

[Nest] 7364  - 02/07/2026, 6:18:31 PM   ERROR [ExceptionsHandler] PrismaClientKnownRequestError:
Invalid `this.prisma.task.create()` invocation in
E:\node-project\challenge-backend\src\tasks\tasks.service.ts:15:29

  12 constructor(private prisma: PrismaService) {}
  13
  14 async create(userId: string, createTaskDto: CreateTaskDto) {
→ 15   return this.prisma.task.create(
Foreign key constraint violated on the foreign key
    at Vr.handleRequestError (E:\node-project\challenge-backend\node_modules\@prisma\client\src\runtime\RequestHandler.ts:228:13)
    at Vr.handleAndLogRequestError (E:\node-project\challenge-backend\node_modules\@prisma\client\src\runtime\RequestHandler.ts:174:12)
    at Vr.request (E:\node-project\challenge-backend\node_modules\@prisma\client\src\runtime\RequestHandler.ts:143:12)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at a (E:\node-project\challenge-backend\node_modules\@prisma\client\src\runtime\getPrismaClient.ts:805:24)
    at E:\node-project\challenge-backend\node_modules\@nestjs\core\router\router-execution-context.js:46:28
    at E:\node-project\challenge-backend\node_modules\@nestjs\core\router\router-proxy.js:9:17 {
  code: 'P2003',
  meta: {
    modelName: 'Task',
    driverAdapterError: DriverAdapterError: ForeignKeyConstraintViolation
        at PrismaBetterSqlite3Adapter.onError (E:\node-project\challenge-backend\node_modules\@prisma\adapter-better-sqlite3\dist\index.js:568:11)
        at PrismaBetterSqlite3Adapter.performIO (E:\node-project\challenge-backend\node_modules\@prisma\adapter-better-sqlite3\dist\index.js:563:12)
        at PrismaBetterSqlite3Adapter.queryRaw (E:\node-project\challenge-backend\node_modules\@prisma\adapter-better-sqlite3\dist\index.js:504:63)
        at E:\node-project\challenge-backend\node_modules\@prisma\client-engine-runtime\src\interpreter\query-interpreter.ts:184:16
        at callback (E:\node-project\challenge-backend\node_modules\@prisma\client-engine-runtime\src\tracing.ts:80:12)
        at e.withQuerySpanAndEvent (E:\node-project\challenge-backend\node_modules\@prisma\client-engine-runtime\src\interpreter\query-interpreter.ts:363:12)
        at e.#withQuerySpanAndEvent [as interpretNode] (E:\node-project\challenge-backend\node_modules\@prisma\client-engine-runtime\src\interpreter\query-interpreter.ts:182:37)
        at e.interpretNode (E:\node-project\challenge-backend\node_modules\@prisma\client-engine-runtime\src\interpreter\query-interpreter.ts:209:52)
        at e.interpretNode (E:\node-project\challenge-backend\node_modules\@prisma\client-engine-runtime\src\interpreter\query-interpreter.ts:127:21)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at e.interpretNode (E:\node-project\challenge-backend\node_modules\@prisma\client-engine-runtime\src\interpreter\query-interpreter.ts:268:41)
        at e.run (E:\node-project\challenge-backend\node_modules\@prisma\client-engine-runtime\src\interpreter\query-interpreter.ts:93:23)
        at execute (E:\node-project\challenge-backend\node_modules\@prisma\client\src\runtime\core\engines\client\LocalExecutor.ts:81:12)
        at Dt.request (E:\node-project\challenge-backend\node_modules\@prisma\client\src\runtime\core\engines\client\ClientEngine.ts:461:22)
        at Object.singleLoader (E:\node-project\challenge-backend\node_modules\@prisma\client\src\runtime\RequestHandler.ts:112:26)
        at Vr.request (E:\node-project\challenge-backend\node_modules\@prisma\client\src\runtime\RequestHandler.ts:140:14)
        at a (E:\node-project\challenge-backend\node_modules\@prisma\client\src\runtime\getPrismaClient.ts:805:24)
        at E:\node-project\challenge-backend\node_modules\@nestjs\core\router\router-execution-context.js:46:28
        at E:\node-project\challenge-backend\node_modules\@nestjs\core\router\router-proxy.js:9:17 {     
      cause: {
        originalCode: 'SQLITE_CONSTRAINT_FOREIGNKEY',
        originalMessage: 'FOREIGN KEY constraint failed',
        kind: 'ForeignKeyConstraintViolation',
        constraint: {
          foreignKey: {}
        }
      }
    }
  },
  clientVersion: '7.3.0'
}
 FAIL  test/users.e2e-spec.ts (9.282 s)    
  ● UsersModule (e2e) › GET /api/users/me › [Sukses] Mengambil profil dengan token yang valid.

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

      53 |         .set('Authorization', `Bearer ${accessToken}`);
      54 |
    > 55 |       expect(response.status).toBe(HttpStatus.OK);
         |                               ^
      56 |       expect(response.body).toBeDefined();
      57 |       expect(response.body.email).toBe(registerUserDto.email);
      58 |       expect(response.body.name).toBe(registerUserDto.name);

      at Object.<anonymous> (users.e2e-spec.ts:55:31)

  ● UsersModule (e2e) › PATCH /api/users/me › [Sukses] Memperbarui nama dan tanggal lahir dengan data yang valid.

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

      79 |         .send(updateUserDto);
      80 |
    > 81 |       expect(response.status).toBe(HttpStatus.OK);
         |                               ^
      82 |       expect(response.body).toBeDefined();
      83 |       expect(response.body.name).toBe(updateUserDto.name);
      84 |       expect(new Date(response.body.birth).toISOString()).toBe(

      at Object.<anonymous> (users.e2e-spec.ts:81:31)

  ● UsersModule (e2e) › PATCH /api/users/me › [Gagal] Memperbarui dengan data yang tidak valid (misalnya, nama bukan string).

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 401

      105 |         .send(invalidUpdateUserDto);
      106 |
    > 107 |       expect(response.status).toBe(HttpStatus.BAD_REQUEST);
          |                               ^
      108 |       expect(response.body.message).toEqual(
      109 |         expect.arrayContaining(['name must be a string']),
      110 |       );

      at Object.<anonymous> (users.e2e-spec.ts:107:31)

 PASS  test/app.e2e-spec.ts
 FAIL  test/tasks.e2e-spec.ts (35.158 s)
  ● TasksModule (e2e) › POST /api/tasks › [Sukses] Pengguna A membuat tugas baru dengan data yang valid. 

    TypeError: Cannot read properties of null (reading 'id')

      53 |       where: { email: userARegisterDto.email },
      54 |     });
    > 55 |     userAId = userA.id;
         |                     ^
      56 |
      57 |     // Register and login User B
      58 |     await registerUser(app, userBRegisterDto);

      at Object.<anonymous> (tasks.e2e-spec.ts:55:21)

  ● TasksModule (e2e) › POST /api/tasks › [Gagal] Membuat tugas dengan data yang tidak valid (misalnya, judul kosong).

    TypeError: Cannot read properties of null (reading 'id')

      65 |       where: { email: userBRegisterDto.email },
      66 |     });
    > 67 |     userBId = userB.id;
         |                     ^
      68 |   });
      69 |
      70 |   afterAll(async () => {

      at Object.<anonymous> (tasks.e2e-spec.ts:67:21)

  ● TasksModule (e2e) › POST /api/tasks › [Gagal] Membuat tugas tanpa token autentikasi.

    TypeError: Cannot read properties of null (reading 'id')

      65 |       where: { email: userBRegisterDto.email },
      66 |     });
    > 67 |     userBId = userB.id;
         |                     ^
      68 |   });
      69 |
      70 |   afterAll(async () => {

      at Object.<anonymous> (tasks.e2e-spec.ts:67:21)

  ● TasksModule (e2e) › GET /api/tasks › [Sukses] Pengguna A mengambil daftar tugasnya.

    TypeError: Cannot read properties of null (reading 'id')

      53 |       where: { email: userARegisterDto.email },
      54 |     });
    > 55 |     userAId = userA.id;
         |                     ^
      56 |
      57 |     // Register and login User B
      58 |     await registerUser(app, userBRegisterDto);

      at Object.<anonymous> (tasks.e2e-spec.ts:55:21)

  ● TasksModule (e2e) › GET /api/tasks › [Gagal] Mengambil daftar tugas tanpa token autentikasi.

    TypeError: Cannot read properties of null (reading 'id')

      53 |       where: { email: userARegisterDto.email },
      54 |     });
    > 55 |     userAId = userA.id;
         |                     ^
      56 |
      57 |     // Register and login User B
      58 |     await registerUser(app, userBRegisterDto);

      at Object.<anonymous> (tasks.e2e-spec.ts:55:21)

  ● TasksModule (e2e) › GET /api/tasks/:id › [Sukses] Pengguna A mengambil detail tugas miliknya.        

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

      202 |         .set('Authorization', `Bearer ${userAToken}`);
      203 |
    > 204 |       expect(response.status).toBe(HttpStatus.OK);
          |                               ^
      205 |       expect(response.body).toBeDefined();
      206 |       expect(response.body.id).toBe(userATaskId);
      207 |       expect(response.body.title).toBe('User A Task');

      at Object.<anonymous> (tasks.e2e-spec.ts:204:31)

  ● TasksModule (e2e) › GET /api/tasks/:id › [Gagal] Pengguna A mengambil detail tugas yang tidak ada (ID salah).

    expect(received).toBe(expected) // Object.is equality

    Expected: 404
    Received: 401

      214 |         .set('Authorization', `Bearer ${userAToken}`);
      215 |
    > 216 |       expect(response.status).toBe(HttpStatus.NOT_FOUND);
          |                               ^
      217 |       expect(response.body.message).toBe('Task not found');
      218 |     });
      219 |

      at Object.<anonymous> (tasks.e2e-spec.ts:216:31)

  ● TasksModule (e2e) › GET /api/tasks/:id › [Gagal] Pengguna B mencoba mengambil detail tugas milik Pengguna A.

    TypeError: Cannot read properties of null (reading 'id')

      65 |       where: { email: userBRegisterDto.email },
      66 |     });
    > 67 |     userBId = userB.id;
         |                     ^
      68 |   });
      69 |
      70 |   afterAll(async () => {

      at Object.<anonymous> (tasks.e2e-spec.ts:67:21)

  ● TasksModule (e2e) › GET /api/tasks/:id › [Gagal] Mengambil detail tugas tanpa token autentikasi.     

    TypeError: Cannot read properties of null (reading 'id')

      53 |       where: { email: userARegisterDto.email },
      54 |     });
    > 55 |     userAId = userA.id;
         |                     ^
      56 |
      57 |     // Register and login User B
      58 |     await registerUser(app, userBRegisterDto);

      at Object.<anonymous> (tasks.e2e-spec.ts:55:21)

  ● TasksModule (e2e) › PATCH /api/tasks/:id › [Sukses] Pengguna A memperbarui tugas miliknya.

    TypeError: Cannot read properties of null (reading 'id')

      53 |       where: { email: userARegisterDto.email },
      54 |     });
    > 55 |     userAId = userA.id;
         |                     ^
      56 |
      57 |     // Register and login User B
      58 |     await registerUser(app, userBRegisterDto);

      at Object.<anonymous> (tasks.e2e-spec.ts:55:21)

  ● TasksModule (e2e) › PATCH /api/tasks/:id › [Gagal] Pengguna B mencoba memperbarui tugas milik Pengguna A.

    TypeError: Cannot read properties of null (reading 'id')

      53 |       where: { email: userARegisterDto.email },
      54 |     });
    > 55 |     userAId = userA.id;
         |                     ^
      56 |
      57 |     // Register and login User B
      58 |     await registerUser(app, userBRegisterDto);

      at Object.<anonymous> (tasks.e2e-spec.ts:55:21)

  ● TasksModule (e2e) › PATCH /api/tasks/:id › [Gagal] Pengguna A memperbarui tugas yang tidak ada (ID salah).

    TypeError: Cannot read properties of null (reading 'id')

      53 |       where: { email: userARegisterDto.email },
      54 |     });
    > 55 |     userAId = userA.id;
         |                     ^
      56 |
      57 |     // Register and login User B
      58 |     await registerUser(app, userBRegisterDto);

      at Object.<anonymous> (tasks.e2e-spec.ts:55:21)

  ● TasksModule (e2e) › PATCH /api/tasks/:id › [Gagal] Memperbarui tugas tanpa token autentikasi.        

    TypeError: Cannot read properties of null (reading 'id')

      53 |       where: { email: userARegisterDto.email },
      54 |     });
    > 55 |     userAId = userA.id;
         |                     ^
      56 |
      57 |     // Register and login User B
      58 |     await registerUser(app, userBRegisterDto);

      at Object.<anonymous> (tasks.e2e-spec.ts:55:21)

  ● TasksModule (e2e) › DELETE /api/tasks/:id › [Sukses] Pengguna A menghapus tugas miliknya.

    expect(received).toBe(expected) // Object.is equality

    Expected: 204
    Received: 401

      325 |         .set('Authorization', `Bearer ${userAToken}`);
      326 |
    > 327 |       expect(response.status).toBe(HttpStatus.NO_CONTENT);
          |                               ^
      328 |
      329 |       // Verify the task is deleted
      330 |       const getResponse = await request(app.getHttpServer())

      at Object.<anonymous> (tasks.e2e-spec.ts:327:31)

  ● TasksModule (e2e) › DELETE /api/tasks/:id › [Gagal] Pengguna B mencoba menghapus tugas milik Pengguna A.

    TypeError: Cannot read properties of null (reading 'id')

      65 |       where: { email: userBRegisterDto.email },
      66 |     });
    > 67 |     userBId = userB.id;
         |                     ^
      68 |   });
      69 |
      70 |   afterAll(async () => {

      at Object.<anonymous> (tasks.e2e-spec.ts:67:21)

  ● TasksModule (e2e) › DELETE /api/tasks/:id › [Gagal] Pengguna A menghapus tugas yang tidak ada (ID salah).

    TypeError: Cannot read properties of null (reading 'id')

      53 |       where: { email: userARegisterDto.email },
      54 |     });
    > 55 |     userAId = userA.id;
         |                     ^
      56 |
      57 |     // Register and login User B
      58 |     await registerUser(app, userBRegisterDto);

      at Object.<anonymous> (tasks.e2e-spec.ts:55:21)

  ● TasksModule (e2e) › DELETE /api/tasks/:id › [Gagal] Menghapus tugas tanpa token autentikasi.

    TypeError: Cannot read properties of null (reading 'id')

      53 |       where: { email: userARegisterDto.email },
      54 |     });
    > 55 |     userAId = userA.id;
         |                     ^
      56 |
      57 |     // Register and login User B
      58 |     await registerUser(app, userBRegisterDto);

      at Object.<anonymous> (tasks.e2e-spec.ts:55:21)

 FAIL  test/tags.e2e-spec.ts (40.877 s)
  ● TagsModule (e2e) › POST /api/tags › [Sukses] Pengguna A membuat tag baru dengan data yang valid.     

    TypeError: Cannot read properties of null (reading 'id')

      65 |       where: { email: userBRegisterDto.email },
      66 |     });
    > 67 |     userBId = userB.id;
         |                     ^
      68 |   });
      69 |
      70 |   afterAll(async () => {

      at Object.<anonymous> (tags.e2e-spec.ts:67:21)

  ● TagsModule (e2e) › POST /api/tags › [Gagal] Membuat tag dengan nama yang duplikat untuk pengguna yang sama.

    TypeError: Cannot read properties of null (reading 'id')

      53 |       where: { email: userARegisterDto.email },
      54 |     });
    > 55 |     userAId = userA.id;
         |                     ^
      56 |
      57 |     // Register and login User B
      58 |     await registerUser(app, userBRegisterDto);

      at Object.<anonymous> (tags.e2e-spec.ts:55:21)

  ● TagsModule (e2e) › GET /api/tags › [Sukses] Pengguna A mengambil daftar tag-nya.

    TypeError: Cannot read properties of null (reading 'id')

      53 |       where: { email: userARegisterDto.email },
      54 |     });
    > 55 |     userAId = userA.id;
         |                     ^
      56 |
      57 |     // Register and login User B
      58 |     await registerUser(app, userBRegisterDto);

      at Object.<anonymous> (tags.e2e-spec.ts:55:21)

  ● TagsModule (e2e) › GET /api/tags/:id › [Sukses] Pengguna A mengambil detail tag miliknya.

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

      171 |         .set('Authorization', `Bearer ${userAToken}`);
      172 |
    > 173 |       expect(response.status).toBe(HttpStatus.OK);
          |                               ^
      174 |       expect(response.body).toBeDefined();
      175 |       expect(response.body.id).toBe(userATagId);
      176 |       expect(response.body.name).toBe('Important');

      at Object.<anonymous> (tags.e2e-spec.ts:173:31)

  ● TagsModule (e2e) › GET /api/tags/:id › [Gagal] Mengambil detail tag yang tidak ada.

    expect(received).toBe(expected) // Object.is equality

    Expected: 404
    Received: 401

      192 |         .set('Authorization', `Bearer ${userAToken}`);
      193 |
    > 194 |       expect(response.status).toBe(HttpStatus.NOT_FOUND);
          |                               ^
      195 |       expect(response.body.message).toBe('Tag not found');
      196 |     });
      197 |   });

      at Object.<anonymous> (tags.e2e-spec.ts:194:31)

  ● TagsModule (e2e) › PATCH /api/tags/:id › [Sukses] Pengguna A memperbarui tag miliknya.

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

      215 |         .send(updateTagDto);
      216 |
    > 217 |       expect(response.status).toBe(HttpStatus.OK);
          |                               ^
      218 |       expect(response.body).toBeDefined();
      219 |       expect(response.body.id).toBe(userATagId);
      220 |       expect(response.body.name).toBe(updateTagDto.name);

      at Object.<anonymous> (tags.e2e-spec.ts:217:31)

  ● TagsModule (e2e) › PATCH /api/tags/:id › [Gagal] Pengguna B mencoba memperbarui tag milik Pengguna A.
    TypeError: Cannot read properties of null (reading 'id')

      53 |       where: { email: userARegisterDto.email },
      54 |     });
    > 55 |     userAId = userA.id;
         |                     ^
      56 |
      57 |     // Register and login User B
      58 |     await registerUser(app, userBRegisterDto);

      at Object.<anonymous> (tags.e2e-spec.ts:55:21)

  ● TagsModule (e2e) › PATCH /api/tags/:id › [Gagal] Memperbarui tag yang tidak ada.

    TypeError: Cannot read properties of null (reading 'id')

      53 |       where: { email: userARegisterDto.email },
      54 |     });
    > 55 |     userAId = userA.id;
         |                     ^
      56 |
      57 |     // Register and login User B
      58 |     await registerUser(app, userBRegisterDto);

      at Object.<anonymous> (tags.e2e-spec.ts:55:21)

  ● TagsModule (e2e) › PATCH /api/tags/:id › [Gagal] Memperbarui dengan nama tag duplikat untuk pengguna 
yang sama.

    TypeError: Cannot read properties of null (reading 'id')

      53 |       where: { email: userARegisterDto.email },
      54 |     });
    > 55 |     userAId = userA.id;
         |                     ^
      56 |
      57 |     // Register and login User B
      58 |     await registerUser(app, userBRegisterDto);

      at Object.<anonymous> (tags.e2e-spec.ts:55:21)

  ● TagsModule (e2e) › DELETE /api/tags/:id › [Sukses] Pengguna A menghapus tag miliknya.

    expect(received).toBe(expected) // Object.is equality

    Expected: 204
    Received: 401

      279 |         .set('Authorization', `Bearer ${userAToken}`);
      280 |
    > 281 |       expect(response.status).toBe(HttpStatus.NO_CONTENT);
          |                               ^
      282 |
      283 |       // Verify the tag is deleted
      284 |       const getResponse = await request(app.getHttpServer())

      at Object.<anonymous> (tags.e2e-spec.ts:281:31)

  ● TagsModule (e2e) › Suite Pengujian: Asosiasi Tugas-Tag (/api/tags/.../tasks/...) › POST /api/tags/:tagId/tasks/:taskId › [Sukses] Mengaitkan tag milik Pengguna A dengan tugas milik Pengguna A.

    TypeError: Cannot read properties of null (reading 'id')

      65 |       where: { email: userBRegisterDto.email },
      66 |     });
    > 67 |     userBId = userB.id;
         |                     ^
      68 |   });
      69 |
      70 |   afterAll(async () => {

      at Object.<anonymous> (tags.e2e-spec.ts:67:21)

  ● TagsModule (e2e) › Suite Pengujian: Asosiasi Tugas-Tag (/api/tags/.../tasks/...) › DELETE /api/tags/:tagId/tasks/:taskId › [Sukses] Melepaskan asosiasi tag dari tugas.

    expect(received).toBeDefined()

    Received: undefined

      411 |
      412 |         expect(taskResponse.status).toBe(HttpStatus.OK);
    > 413 |         expect(taskResponse.body.tags).toBeDefined();
          |                                        ^
      414 |         expect(
      415 |           taskResponse.body.tags.some((tag) => tag.id === userATagId),
      416 |         ).toBeFalsy();

      at Object.<anonymous> (tags.e2e-spec.ts:413:40)

Test Suites: 4 failed, 1 passed, 5 total
Tests:       33 failed, 21 passed, 54 total
Snapshots:   0 total
Time:        45.077 s
Ran all test suites.