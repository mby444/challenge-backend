
E:\node-project\challenge-backend>t

E:\node-project\challenge-backend>npm run test:e2e 

> challenge-backend@0.0.1 test:e2e
> jest --config ./test/jest-e2e.json

 PASS  test/auth.e2e-spec.ts (19.51 s)
  ● Console

    console.log
      log response 1 status 201 headers {
        'x-powered-by': 'Express',
        'content-type': 'application/json; charset=utf-8',
        'content-length': '204',
        etag: 'W/"cc-3eW8BQDcVktuwT4AxIErzSu1+BE"',       
        date: 'Sat, 07 Feb 2026 12:05:07 GMT',
        connection: 'close'
      } body {
        id: '08647928-c08f-4ece-9cc8-7138e38bfb97',
        email: 'test@example.com',
        name: 'Test User',
        birth: '2000-01-01T00:00:00.000Z',
        createdAt: '2026-02-07T12:05:07.367Z',
        updatedAt: '2026-02-07T12:05:07.367Z'
      }

      at Object.<anonymous> (auth.e2e-spec.ts:50:15)

    console.log
      log response 1 status 409 headers {
        'x-powered-by': 'Express',
        'content-type': 'application/json; charset=utf-8',
        'content-length': '70',
        etag: 'W/"46-7AVGAoBkmZbRAufGWQaVlmZxt9Q"',
        date: 'Sat, 07 Feb 2026 12:05:07 GMT',
        connection: 'close'
      } body { message: 'Email already exists', error: 'Conflict', statusCode: 409 }

      at Object.<anonymous> (auth.e2e-spec.ts:61:15)

 FAIL  test/users.e2e-spec.ts (8.111 s)    
  ● UsersModule (e2e) › GET /api/users/me › [Sukses] Mengambil profil dengan token yang valid.

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

      53 |         .set('Authorization', `Bearer ${accessToken}`);
      54 |
    > 55 |       expect(response.status).toBe(HttpStatus.OK);
         |                               ^
      56 |       expect(response.body).toBeDefined();
      57 |       expect(response.body.email).toBe(registerUserDto.email);
      58 |       expect(response.body.name).toBe(registerUserDto.name);

      at Object.<anonymous> (users.e2e-spec.ts:55:31)

[Nest] 4508  - 02/07/2026, 7:05:23 PM   ERROR [ExceptionsHandler] PrismaClientKnownRequestError:
Invalid `this.prisma.tag.update()` invocation in
E:\node-project\challenge-backend\src\tags\tags.service.ts:69:30

  66 }
  67
  68 try {
→ 69   return this.prisma.tag.update(
Unique constraint failed on the fields: (`userId`, `name`)
    at Vr.handleRequestError (E:\node-project\challenge-backend\node_modules\@prisma\client\src\runtime\RequestHandler.ts:228:13)
    at Vr.handleAndLogRequestError (E:\node-project\challenge-backend\node_modules\@prisma\client\src\runtime\RequestHandler.ts:174:12)
    at Vr.request (E:\node-project\challenge-backend\node_modules\@prisma\client\src\runtime\RequestHandler.ts:143:12)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at a (E:\node-project\challenge-backend\node_modules\@prisma\client\src\runtime\getPrismaClient.ts:805:24)
    at E:\node-project\challenge-backend\node_modules\@nestjs\core\router\router-execution-context.js:46:28
    at E:\node-project\challenge-backend\node_modules\@nestjs\core\router\router-proxy.js:9:17 {
  code: 'P2002',
  meta: {
    modelName: 'Tag',
    driverAdapterError: DriverAdapterError: UniqueConstraintViolation
        at PrismaBetterSqlite3Adapter.onError (E:\node-project\challenge-backend\node_modules\@prisma\adapter-better-sqlite3\dist\index.js:568:11)
        at PrismaBetterSqlite3Adapter.performIO (E:\node-project\challenge-backend\node_modules\@prisma\adapter-better-sqlite3\dist\index.js:563:12)
        at PrismaBetterSqlite3Adapter.queryRaw (E:\node-project\challenge-backend\node_modules\@prisma\adapter-better-sqlite3\dist\index.js:504:63)
        at E:\node-project\challenge-backend\node_modules\@prisma\client-engine-runtime\src\interpreter\query-interpreter.ts:184:16
        at callback (E:\node-project\challenge-backend\node_modules\@prisma\client-engine-runtime\src\tracing.ts:80:12)
        at e.withQuerySpanAndEvent (E:\node-project\challenge-backend\node_modules\@prisma\client-engine-runtime\src\interpreter\query-interpreter.ts:363:12)
        at e.#withQuerySpanAndEvent [as interpretNode] (E:\node-project\challenge-backend\node_modules\@prisma\client-engine-runtime\src\interpreter\query-interpreter.ts:182:37)
        at e.interpretNode (E:\node-project\challenge-backend\node_modules\@prisma\client-engine-runtime\src\interpreter\query-interpreter.ts:209:52)
        at e.interpretNode (E:\node-project\challenge-backend\node_modules\@prisma\client-engine-runtime\src\interpreter\query-interpreter.ts:124:40)
        at e.interpretNode (E:\node-project\challenge-backend\node_modules\@prisma\client-engine-runtime\src\interpreter\query-interpreter.ts:268:52)
        at e.run (E:\node-project\challenge-backend\node_modules\@prisma\client-engine-runtime\src\interpreter\query-interpreter.ts:93:34)
        at execute (E:\node-project\challenge-backend\node_modules\@prisma\client\src\runtime\core\engines\client\LocalExecutor.ts:81:36)
        at Dt.request (E:\node-project\challenge-backend\node_modules\@prisma\client\src\runtime\core\engines\client\ClientEngine.ts:461:37)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at Object.singleLoader (E:\node-project\challenge-backend\node_modules\@prisma\client\src\runtime\RequestHandler.ts:112:26)
        at Vr.request (E:\node-project\challenge-backend\node_modules\@prisma\client\src\runtime\RequestHandler.ts:140:14)
        at a (E:\node-project\challenge-backend\node_modules\@prisma\client\src\runtime\getPrismaClient.ts:805:24)
        at E:\node-project\challenge-backend\node_modules\@nestjs\core\router\router-execution-context.js:46:28
        at E:\node-project\challenge-backend\node_modules\@nestjs\core\router\router-proxy.js:9:17 {     
      cause: {
        originalCode: 'SQLITE_CONSTRAINT_UNIQUE',
        originalMessage: 'UNIQUE constraint failed: Tag.userId, Tag.name',
        kind: 'UniqueConstraintViolation',
        constraint: {
          fields: [
            'userId',
            'name'
          ]
        }
      }
    }
  },
  clientVersion: '7.3.0'
}
 PASS  test/app.e2e-spec.ts
 FAIL  test/tasks.e2e-spec.ts (39.517 s)
  ● TasksModule (e2e) › POST /api/tasks › [Sukses] Pengguna A membuat tugas baru dengan data yang valid. 

    expect(received).toBe(expected) // Object.is equality

    Expected: 201
    Received: 401

      83 |         .send(createTaskDto);
      84 |
    > 85 |       expect(response.status).toBe(HttpStatus.CREATED);
         |                               ^
      86 |       expect(response.body).toBeDefined();
      87 |       expect(response.body.title).toBe(createTaskDto.title);
      88 |       expect(response.body.description).toBe(createTaskDto.description);

      at Object.<anonymous> (tasks.e2e-spec.ts:85:31)

  ● TasksModule (e2e) › GET /api/tasks › [Sukses] Pengguna A mengambil daftar tugasnya.

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

      139 |         .set('Authorization', `Bearer ${userAToken}`);
      140 |
    > 141 |       expect(response.status).toBe(HttpStatus.OK);
          |                               ^
      142 |       expect(response.body).toBeInstanceOf(Array);
      143 |       expect(response.body.length).toBe(2);
      144 |       expect(response.body.map((task) => task.title)).toEqual(

      at Object.<anonymous> (tasks.e2e-spec.ts:141:31)

  ● TasksModule (e2e) › GET /api/tasks › [Sukses] Pengguna yang belum punya tugas mengambil daftar tugasnya.

    TypeError: Cannot read properties of null (reading 'id')

      65 |       where: { email: userBRegisterDto.email },
      66 |     });
    > 67 |     userBId = userB.id;
         |                     ^
      68 |   });
      69 |
      70 |   afterAll(async () => {

      at Object.<anonymous> (tasks.e2e-spec.ts:67:21)

  ● TasksModule (e2e) › GET /api/tasks/:id › [Sukses] Pengguna A mengambil detail tugas miliknya.        

    TypeError: Cannot read properties of null (reading 'id')

      65 |       where: { email: userBRegisterDto.email },
      66 |     });
    > 67 |     userBId = userB.id;
         |                     ^
      68 |   });
      69 |
      70 |   afterAll(async () => {

      at Object.<anonymous> (tasks.e2e-spec.ts:67:21)

  ● TasksModule (e2e) › GET /api/tasks/:id › [Gagal] Pengguna A mengambil detail tugas yang tidak ada (ID salah).

    TypeError: Cannot read properties of null (reading 'id')

      65 |       where: { email: userBRegisterDto.email },
      66 |     });
    > 67 |     userBId = userB.id;
         |                     ^
      68 |   });
      69 |
      70 |   afterAll(async () => {

      at Object.<anonymous> (tasks.e2e-spec.ts:67:21)

  ● TasksModule (e2e) › GET /api/tasks/:id › [Gagal] Pengguna B mencoba mengambil detail tugas milik Pengguna A.

    TypeError: Cannot read properties of null (reading 'id')

      53 |       where: { email: userARegisterDto.email },
      54 |     });
    > 55 |     userAId = userA.id;
         |                     ^
      56 |
      57 |     // Register and login User B
      58 |     await registerUser(app, userBRegisterDto);

      at Object.<anonymous> (tasks.e2e-spec.ts:55:21)

  ● TasksModule (e2e) › GET /api/tasks/:id › [Gagal] Mengambil detail tugas tanpa token autentikasi.     

    TypeError: Cannot read properties of null (reading 'id')

      53 |       where: { email: userARegisterDto.email },
      54 |     });
    > 55 |     userAId = userA.id;
         |                     ^
      56 |
      57 |     // Register and login User B
      58 |     await registerUser(app, userBRegisterDto);

      at Object.<anonymous> (tasks.e2e-spec.ts:55:21)

  ● TasksModule (e2e) › PATCH /api/tasks/:id › [Sukses] Pengguna A memperbarui tugas miliknya.

    TypeError: Cannot read properties of null (reading 'id')

      53 |       where: { email: userARegisterDto.email },
      54 |     });
    > 55 |     userAId = userA.id;
         |                     ^
      56 |
      57 |     // Register and login User B
      58 |     await registerUser(app, userBRegisterDto);

      at Object.<anonymous> (tasks.e2e-spec.ts:55:21)

  ● TasksModule (e2e) › PATCH /api/tasks/:id › [Gagal] Pengguna B mencoba memperbarui tugas milik Pengguna A.

    TypeError: Cannot read properties of null (reading 'id')

      53 |       where: { email: userARegisterDto.email },
      54 |     });
    > 55 |     userAId = userA.id;
         |                     ^
      56 |
      57 |     // Register and login User B
      58 |     await registerUser(app, userBRegisterDto);

      at Object.<anonymous> (tasks.e2e-spec.ts:55:21)

  ● TasksModule (e2e) › DELETE /api/tasks/:id › [Sukses] Pengguna A menghapus tugas miliknya.

    TypeError: Cannot read properties of null (reading 'id')

      65 |       where: { email: userBRegisterDto.email },
      66 |     });
    > 67 |     userBId = userB.id;
         |                     ^
      68 |   });
      69 |
      70 |   afterAll(async () => {

      at Object.<anonymous> (tasks.e2e-spec.ts:67:21)

  ● TasksModule (e2e) › DELETE /api/tasks/:id › [Gagal] Pengguna B mencoba menghapus tugas milik Pengguna A.

    expect(received).toBe(expected) // Object.is equality

    Expected: 401
    Received: 404

      339 |         .set('Authorization', `Bearer ${userBToken}`);
      340 |
    > 341 |       expect(response.status).toBe(HttpStatus.UNAUTHORIZED);
          |                               ^
      342 |     });
      343 |
      344 |     it('[Gagal] Pengguna A menghapus tugas yang tidak ada (ID salah).', async () => {        

      at Object.<anonymous> (tasks.e2e-spec.ts:341:31)

 FAIL  test/tags.e2e-spec.ts (44.698 s)
  ● TagsModule (e2e) › POST /api/tags › [Sukses] Pengguna A membuat tag baru dengan data yang valid.     

    TypeError: Cannot read properties of null (reading 'id')

      53 |       where: { email: userARegisterDto.email },
      54 |     });
    > 55 |     userAId = userA.id;
         |                     ^
      56 |
      57 |     // Register and login User B
      58 |     await registerUser(app, userBRegisterDto);

      at Object.<anonymous> (tags.e2e-spec.ts:55:21)

  ● TagsModule (e2e) › POST /api/tags › [Gagal] Membuat tag dengan nama yang duplikat untuk pengguna yang sama.

    TypeError: Cannot read properties of null (reading 'id')

      53 |       where: { email: userARegisterDto.email },
      54 |     });
    > 55 |     userAId = userA.id;
         |                     ^
      56 |
      57 |     // Register and login User B
      58 |     await registerUser(app, userBRegisterDto);

      at Object.<anonymous> (tags.e2e-spec.ts:55:21)

  ● TagsModule (e2e) › GET /api/tags › [Sukses] Pengguna A mengambil daftar tag-nya.

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

      137 |         .set('Authorization', `Bearer ${userAToken}`);
      138 |
    > 139 |       expect(response.status).toBe(HttpStatus.OK);
          |                               ^
      140 |       expect(response.body).toBeInstanceOf(Array);
      141 |       expect(response.body.length).toBe(2);
      142 |       expect(response.body.map((tag) => tag.name)).toEqual(

      at Object.<anonymous> (tags.e2e-spec.ts:139:31)

  ● TagsModule (e2e) › GET /api/tags/:id › [Gagal] Mengambil detail tag yang tidak ada.

    expect(received).toBe(expected) // Object.is equality

    Expected: 404
    Received: 401

      192 |         .set('Authorization', `Bearer ${userAToken}`);
      193 |
    > 194 |       expect(response.status).toBe(HttpStatus.NOT_FOUND);
          |                               ^
      195 |       expect(response.body.message).toBe('Tag not found');
      196 |     });
      197 |   });

      at Object.<anonymous> (tags.e2e-spec.ts:194:31)

  ● TagsModule (e2e) › PATCH /api/tags/:id › [Sukses] Pengguna A memperbarui tag miliknya.

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

      215 |         .send(updateTagDto);
      216 |
    > 217 |       expect(response.status).toBe(HttpStatus.OK);
          |                               ^
      218 |       expect(response.body).toBeDefined();
      219 |       expect(response.body.id).toBe(userATagId);
      220 |       expect(response.body.name).toBe(updateTagDto.name);

      at Object.<anonymous> (tags.e2e-spec.ts:217:31)

  ● TagsModule (e2e) › PATCH /api/tags/:id › [Gagal] Pengguna B mencoba memperbarui tag milik Pengguna A.
    expect(received).toBe(expected) // Object.is equality

    Expected: 401
    Received: 404

      228 |         .send(updateTagDto);
      229 |
    > 230 |       expect(response.status).toBe(HttpStatus.UNAUTHORIZED);
          |                               ^
      231 |     });
      232 |
      233 |     it('[Gagal] Memperbarui tag yang tidak ada.', async () => {

      at Object.<anonymous> (tags.e2e-spec.ts:230:31)

  ● TagsModule (e2e) › PATCH /api/tags/:id › [Gagal] Memperbarui tag yang tidak ada.

    expect(received).toBe(expected) // Object.is equality

    Expected: 404
    Received: 401

      239 |         .send(updateTagDto);
      240 |
    > 241 |       expect(response.status).toBe(HttpStatus.NOT_FOUND);
          |                               ^
      242 |       expect(response.body.message).toBe('Tag not found');
      243 |     });
      244 |

      at Object.<anonymous> (tags.e2e-spec.ts:241:31)

  ● TagsModule (e2e) › PATCH /api/tags/:id › [Gagal] Memperbarui dengan nama tag duplikat untuk pengguna 
yang sama.

    expect(received).toBe(expected) // Object.is equality

    Expected: 409
    Received: 500

      256 |         .send(updateTagDto);
      257 |
    > 258 |       expect(response.status).toBe(HttpStatus.CONFLICT);
          |                               ^
      259 |       expect(response.body.message).toBe(
      260 |         'Tag with this name already exists for this user',
      261 |       );

      at Object.<anonymous> (tags.e2e-spec.ts:258:31)

  ● TagsModule (e2e) › Suite Pengujian: Asosiasi Tugas-Tag (/api/tags/.../tasks/...) › POST /api/tags/:tagId/tasks/:taskId › [Sukses] Mengaitkan tag milik Pengguna A dengan tugas milik Pengguna A.

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

      348 |           .set('Authorization', `Bearer ${userAToken}`);
      349 |
    > 350 |         expect(taskResponse.status).toBe(HttpStatus.OK);
          |                                     ^
      351 |         expect(taskResponse.body.tags).toBeDefined();
      352 |         expect(
      353 |           taskResponse.body.tags.some((tag) => tag.id === userATagId),

      at Object.<anonymous> (tags.e2e-spec.ts:350:37)

  ● TagsModule (e2e) › Suite Pengujian: Asosiasi Tugas-Tag (/api/tags/.../tasks/...) › DELETE /api/tags/:tagId/tasks/:taskId › [Sukses] Melepaskan asosiasi tag dari tugas.

    expect(received).toBeDefined()

    Received: undefined

      411 |
      412 |         expect(taskResponse.status).toBe(HttpStatus.OK);
    > 413 |         expect(taskResponse.body.tags).toBeDefined();
          |                                        ^
      414 |         expect(
      415 |           taskResponse.body.tags.some((tag) => tag.id === userATagId),
      416 |         ).toBeFalsy();

      at Object.<anonymous> (tags.e2e-spec.ts:413:40)

Test Suites: 3 failed, 2 passed, 5 total
Tests:       22 failed, 32 passed, 54 total
Snapshots:   0 total
Time:        49.116 s, estimated 58 s
Ran all test suites.