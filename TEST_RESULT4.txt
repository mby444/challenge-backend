> challenge-backend@0.0.1 test:e2e
> jest --config ./test/jest-e2e.json

 FAIL  test/auth.e2e-spec.ts (17.484 s)
  ● AuthModule (e2e) › POST /api/auth/register › [Gagal] Mendaftar dengan email yang sudah ada.

    expect(received).toBe(expected) // Object.is equality

    Expected: 409
    Received: 201

      51 |       const response = await registerUser(app, registerUserDto); // Second registration with same email
      52 |
    > 53 |       expect(response.status).toBe(409);
         |                               ^
      54 |       expect(response.body.message).toBe('Email already exists');
      55 |     });
      56 |

      at Object.<anonymous> (auth.e2e-spec.ts:53:31)

 FAIL  test/users.e2e-spec.ts (10.656 s)   
  ● UsersModule (e2e) › PATCH /api/users/me › [Gagal] Memperbarui dengan data yang tidak valid (misalnya, nama bukan string).

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 401

      105 |         .send(invalidUpdateUserDto);
      106 |
    > 107 |       expect(response.status).toBe(HttpStatus.BAD_REQUEST);
          |                               ^
      108 |       expect(response.body.message).toEqual(
      109 |         expect.arrayContaining(['name must be a string']),
      110 |       );

      at Object.<anonymous> (users.e2e-spec.ts:107:31)

  ● UsersModule (e2e) › DELETE /api/users/me › [Sukses] Menghapus akun sendiri dengan token yang valid.  

    expect(received).toBe(expected) // Object.is equality

    Expected: 204
    Received: 401

      118 |         .set('Authorization', `Bearer ${accessToken}`);
      119 |
    > 120 |       expect(deleteResponse.status).toBe(HttpStatus.NO_CONTENT);
          |                                     ^
      121 |
      122 |       // Verify user is deleted by trying to log in
      123 |       const loginAttemptAfterDelete = await loginUser(app, {

      at Object.<anonymous> (users.e2e-spec.ts:120:37)

 PASS  test/app.e2e-spec.ts
[Nest] 20476  - 02/07/2026, 5:55:14 PM   ERROR [ExceptionsHandler] PrismaClientKnownRequestError:        
Invalid `this.prisma.task.create()` invocation in
E:\node-project\challenge-backend\src\tasks\tasks.service.ts:15:29

  12 constructor(private prisma: PrismaService) {}
  13
  14 async create(userId: string, createTaskDto: CreateTaskDto) {
→ 15   return this.prisma.task.create(
Foreign key constraint violated on the foreign key
    at Vr.handleRequestError (E:\node-project\challenge-backend\node_modules\@prisma\client\src\runtime\RequestHandler.ts:228:13)
    at Vr.handleAndLogRequestError (E:\node-project\challenge-backend\node_modules\@prisma\client\src\runtime\RequestHandler.ts:174:12)
    at Vr.request (E:\node-project\challenge-backend\node_modules\@prisma\client\src\runtime\RequestHandler.ts:143:12)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at a (E:\node-project\challenge-backend\node_modules\@prisma\client\src\runtime\getPrismaClient.ts:805:24)
    at E:\node-project\challenge-backend\node_modules\@nestjs\core\router\router-execution-context.js:46:28
    at E:\node-project\challenge-backend\node_modules\@nestjs\core\router\router-proxy.js:9:17 {
  code: 'P2003',
  meta: {
    modelName: 'Task',
    driverAdapterError: DriverAdapterError: ForeignKeyConstraintViolation
        at PrismaBetterSqlite3Adapter.onError (E:\node-project\challenge-backend\node_modules\@prisma\adapter-better-sqlite3\dist\index.js:568:11)
        at PrismaBetterSqlite3Adapter.performIO (E:\node-project\challenge-backend\node_modules\@prisma\adapter-better-sqlite3\dist\index.js:563:12)
        at PrismaBetterSqlite3Adapter.queryRaw (E:\node-project\challenge-backend\node_modules\@prisma\adapter-better-sqlite3\dist\index.js:504:63)
        at E:\node-project\challenge-backend\node_modules\@prisma\client-engine-runtime\src\interpreter\query-interpreter.ts:184:16
        at callback (E:\node-project\challenge-backend\node_modules\@prisma\client-engine-runtime\src\tracing.ts:80:12)
        at e.withQuerySpanAndEvent (E:\node-project\challenge-backend\node_modules\@prisma\client-engine-runtime\src\interpreter\query-interpreter.ts:363:12)
        at e.#withQuerySpanAndEvent [as interpretNode] (E:\node-project\challenge-backend\node_modules\@prisma\client-engine-runtime\src\interpreter\query-interpreter.ts:182:37)
        at e.interpretNode (E:\node-project\challenge-backend\node_modules\@prisma\client-engine-runtime\src\interpreter\query-interpreter.ts:209:52)
        at e.interpretNode (E:\node-project\challenge-backend\node_modules\@prisma\client-engine-runtime\src\interpreter\query-interpreter.ts:127:21)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at e.interpretNode (E:\node-project\challenge-backend\node_modules\@prisma\client-engine-runtime\src\interpreter\query-interpreter.ts:268:41)
        at e.run (E:\node-project\challenge-backend\node_modules\@prisma\client-engine-runtime\src\interpreter\query-interpreter.ts:93:23)
        at execute (E:\node-project\challenge-backend\node_modules\@prisma\client\src\runtime\core\engines\client\LocalExecutor.ts:81:12)
        at Dt.request (E:\node-project\challenge-backend\node_modules\@prisma\client\src\runtime\core\engines\client\ClientEngine.ts:461:22)
        at Object.singleLoader (E:\node-project\challenge-backend\node_modules\@prisma\client\src\runtime\RequestHandler.ts:112:26)
        at Vr.request (E:\node-project\challenge-backend\node_modules\@prisma\client\src\runtime\RequestHandler.ts:140:14)
        at a (E:\node-project\challenge-backend\node_modules\@prisma\client\src\runtime\getPrismaClient.ts:805:24)
        at E:\node-project\challenge-backend\node_modules\@nestjs\core\router\router-execution-context.js:46:28
        at E:\node-project\challenge-backend\node_modules\@nestjs\core\router\router-proxy.js:9:17 {     
      cause: {
        originalCode: 'SQLITE_CONSTRAINT_FOREIGNKEY',
        originalMessage: 'FOREIGN KEY constraint failed',
        kind: 'ForeignKeyConstraintViolation',
        constraint: {
          foreignKey: {}
        }
      }
    }
  },
  clientVersion: '7.3.0'
}
 FAIL  test/tasks.e2e-spec.ts (37.494 s)
  ● TasksModule (e2e) › POST /api/tasks › [Sukses] Pengguna A membuat tugas baru dengan data yang valid. 

    TypeError: Cannot read properties of null (reading 'id')

      53 |       where: { email: userARegisterDto.email },
      54 |     });
    > 55 |     userAId = userA.id;
         |                     ^
      56 |
      57 |     // Register and login User B
      58 |     await registerUser(app, userBRegisterDto);

      at Object.<anonymous> (tasks.e2e-spec.ts:55:21)

  ● TasksModule (e2e) › POST /api/tasks › [Gagal] Membuat tugas dengan data yang tidak valid (misalnya, judul kosong).

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 401

      100 |         .send(invalidCreateTaskDto);
      101 |
    > 102 |       expect(response.status).toBe(HttpStatus.BAD_REQUEST);
          |                               ^
      103 |       expect(response.body.message).toEqual(
      104 |         expect.arrayContaining(['title should not be empty']),
      105 |       );

      at Object.<anonymous> (tasks.e2e-spec.ts:102:31)

  ● TasksModule (e2e) › POST /api/tasks › [Gagal] Membuat tugas tanpa token autentikasi.

    TypeError: Cannot read properties of null (reading 'id')

      53 |       where: { email: userARegisterDto.email },
      54 |     });
    > 55 |     userAId = userA.id;
         |                     ^
      56 |
      57 |     // Register and login User B
      58 |     await registerUser(app, userBRegisterDto);

      at Object.<anonymous> (tasks.e2e-spec.ts:55:21)

  ● TasksModule (e2e) › GET /api/tasks › [Sukses] Pengguna A mengambil daftar tugasnya.

    TypeError: Cannot read properties of null (reading 'id')

      53 |       where: { email: userARegisterDto.email },
      54 |     });
    > 55 |     userAId = userA.id;
         |                     ^
      56 |
      57 |     // Register and login User B
      58 |     await registerUser(app, userBRegisterDto);

      at Object.<anonymous> (tasks.e2e-spec.ts:55:21)

  ● TasksModule (e2e) › GET /api/tasks › [Sukses] Pengguna yang belum punya tugas mengambil daftar tugasnya.

    TypeError: Cannot read properties of null (reading 'id')

      53 |       where: { email: userARegisterDto.email },
      54 |     });
    > 55 |     userAId = userA.id;
         |                     ^
      56 |
      57 |     // Register and login User B
      58 |     await registerUser(app, userBRegisterDto);

      at Object.<anonymous> (tasks.e2e-spec.ts:55:21)

  ● TasksModule (e2e) › GET /api/tasks/:id › [Gagal] Pengguna A mengambil detail tugas yang tidak ada (ID salah).

    TypeError: Cannot read properties of null (reading 'id')

      65 |       where: { email: userBRegisterDto.email },
      66 |     });
    > 67 |     userBId = userB.id;
         |                     ^
      68 |   });
      69 |
      70 |   afterAll(async () => {

      at Object.<anonymous> (tasks.e2e-spec.ts:67:21)

  ● TasksModule (e2e) › GET /api/tasks/:id › [Gagal] Pengguna B mencoba mengambil detail tugas milik Pengguna A.

    expect(received).toBe(expected) // Object.is equality

    Expected: 401
    Received: 404

      223 |         .set('Authorization', `Bearer ${userBToken}`);
      224 |
    > 225 |       expect(response.status).toBe(HttpStatus.UNAUTHORIZED);
          |                               ^
      226 |     });
      227 |
      228 |     it('[Gagal] Mengambil detail tugas tanpa token autentikasi.', async () => {

      at Object.<anonymous> (tasks.e2e-spec.ts:225:31)

  ● TasksModule (e2e) › GET /api/tasks/:id › [Gagal] Mengambil detail tugas tanpa token autentikasi.     

    TypeError: Cannot read properties of null (reading 'id')

      65 |       where: { email: userBRegisterDto.email },
      66 |     });
    > 67 |     userBId = userB.id;
         |                     ^
      68 |   });
      69 |
      70 |   afterAll(async () => {

      at Object.<anonymous> (tasks.e2e-spec.ts:67:21)

  ● TasksModule (e2e) › PATCH /api/tasks/:id › [Sukses] Pengguna A memperbarui tugas miliknya.

    TypeError: Cannot read properties of null (reading 'id')

      53 |       where: { email: userARegisterDto.email },
      54 |     });
    > 55 |     userAId = userA.id;
         |                     ^
      56 |
      57 |     // Register and login User B
      58 |     await registerUser(app, userBRegisterDto);

      at Object.<anonymous> (tasks.e2e-spec.ts:55:21)

 FAIL  test/tags.e2e-spec.ts (40.631 s)
  ● TagsModule (e2e) › POST /api/tags › [Sukses] Pengguna A membuat tag baru dengan data yang valid.     

    expect(received).toBe(expected) // Object.is equality

    Expected: 201
    Received: 401

      80 |         .send(createTagDto);
      81 |
    > 82 |       expect(response.status).toBe(HttpStatus.CREATED);
         |                               ^
      83 |       expect(response.body).toBeDefined();
      84 |       expect(response.body.name).toBe(createTagDto.name);
      85 |       expect(response.body.userId).toBe(userAId);

      at Object.<anonymous> (tags.e2e-spec.ts:82:31)

  ● TagsModule (e2e) › POST /api/tags › [Gagal] Membuat tag dengan nama yang duplikat untuk pengguna yang sama.

    TypeError: Cannot read properties of null (reading 'id')

      65 |       where: { email: userBRegisterDto.email },
      66 |     });
    > 67 |     userBId = userB.id;
         |                     ^
      68 |   });
      69 |
      70 |   afterAll(async () => {

      at Object.<anonymous> (tags.e2e-spec.ts:67:21)

  ● TagsModule (e2e) › POST /api/tags › [Gagal] Membuat tag tanpa token autentikasi.

    TypeError: Cannot read properties of null (reading 'id')

      53 |       where: { email: userARegisterDto.email },
      54 |     });
    > 55 |     userAId = userA.id;
         |                     ^
      56 |
      57 |     // Register and login User B
      58 |     await registerUser(app, userBRegisterDto);

      at Object.<anonymous> (tags.e2e-spec.ts:55:21)

  ● TagsModule (e2e) › GET /api/tags › [Sukses] Pengguna A mengambil daftar tag-nya.

    TypeError: Cannot read properties of null (reading 'id')

      53 |       where: { email: userARegisterDto.email },
      54 |     });
    > 55 |     userAId = userA.id;
         |                     ^
      56 |
      57 |     // Register and login User B
      58 |     await registerUser(app, userBRegisterDto);

      at Object.<anonymous> (tags.e2e-spec.ts:55:21)

  ● TagsModule (e2e) › GET /api/tags › [Gagal] Mengambil daftar tag tanpa token autentikasi.

    TypeError: Cannot read properties of null (reading 'id')

      53 |       where: { email: userARegisterDto.email },
      54 |     });
    > 55 |     userAId = userA.id;
         |                     ^
      56 |
      57 |     // Register and login User B
      58 |     await registerUser(app, userBRegisterDto);

      at Object.<anonymous> (tags.e2e-spec.ts:55:21)

  ● TagsModule (e2e) › GET /api/tags/:id › [Gagal] Mengambil detail tag yang tidak ada.

    TypeError: Cannot read properties of null (reading 'id')

      65 |       where: { email: userBRegisterDto.email },
      66 |     });
    > 67 |     userBId = userB.id;
         |                     ^
      68 |   });
      69 |
      70 |   afterAll(async () => {

      at Object.<anonymous> (tags.e2e-spec.ts:67:21)

  ● TagsModule (e2e) › PATCH /api/tags/:id › [Sukses] Pengguna A memperbarui tag miliknya.

    TypeError: Cannot read properties of null (reading 'id')

      65 |       where: { email: userBRegisterDto.email },
      66 |     });
    > 67 |     userBId = userB.id;
         |                     ^
      68 |   });
      69 |
      70 |   afterAll(async () => {

      at Object.<anonymous> (tags.e2e-spec.ts:67:21)

  ● TagsModule (e2e) › PATCH /api/tags/:id › [Gagal] Pengguna B mencoba memperbarui tag milik Pengguna A.
    TypeError: Cannot read properties of null (reading 'id')

      53 |       where: { email: userARegisterDto.email },
      54 |     });
    > 55 |     userAId = userA.id;
         |                     ^
      56 |
      57 |     // Register and login User B
      58 |     await registerUser(app, userBRegisterDto);

      at Object.<anonymous> (tags.e2e-spec.ts:55:21)

  ● TagsModule (e2e) › PATCH /api/tags/:id › [Gagal] Memperbarui tag yang tidak ada.

    TypeError: Cannot read properties of null (reading 'id')

      53 |       where: { email: userARegisterDto.email },
      54 |     });
    > 55 |     userAId = userA.id;
         |                     ^
      56 |
      57 |     // Register and login User B
      58 |     await registerUser(app, userBRegisterDto);

      at Object.<anonymous> (tags.e2e-spec.ts:55:21)

  ● TagsModule (e2e) › PATCH /api/tags/:id › [Gagal] Memperbarui dengan nama tag duplikat untuk pengguna 
yang sama.

    TypeError: Cannot read properties of null (reading 'id')

      53 |       where: { email: userARegisterDto.email },
      54 |     });
    > 55 |     userAId = userA.id;
         |                     ^
      56 |
      57 |     // Register and login User B
      58 |     await registerUser(app, userBRegisterDto);

      at Object.<anonymous> (tags.e2e-spec.ts:55:21)

  ● TagsModule (e2e) › DELETE /api/tags/:id › [Sukses] Pengguna A menghapus tag miliknya.

    TypeError: Cannot read properties of null (reading 'id')

      65 |       where: { email: userBRegisterDto.email },
      66 |     });
    > 67 |     userBId = userB.id;
         |                     ^
      68 |   });
      69 |
      70 |   afterAll(async () => {

      at Object.<anonymous> (tags.e2e-spec.ts:67:21)

  ● TagsModule (e2e) › DELETE /api/tags/:id › [Gagal] Pengguna B mencoba menghapus tag milik Pengguna A. 

    TypeError: Cannot read properties of null (reading 'id')

      65 |       where: { email: userBRegisterDto.email },
      66 |     });
    > 67 |     userBId = userB.id;
         |                     ^
      68 |   });
      69 |
      70 |   afterAll(async () => {

      at Object.<anonymous> (tags.e2e-spec.ts:67:21)

  ● TagsModule (e2e) › Suite Pengujian: Asosiasi Tugas-Tag (/api/tags/.../tasks/...) › POST /api/tags/:tagId/tasks/:taskId › [Sukses] Mengaitkan tag milik Pengguna A dengan tugas milik Pengguna A.

    expect(received).toBe(expected) // Object.is equality

    Expected: 201
    Received: 401

      341 |           .set('Authorization', `Bearer ${userAToken}`);
      342 |
    > 343 |         expect(response.status).toBe(HttpStatus.CREATED);
          |                                 ^
      344 |
      345 |         // Verify association by fetching the task and checking its tags
      346 |         const taskResponse = await request(app.getHttpServer())

      at Object.<anonymous> (tags.e2e-spec.ts:343:33)

  ● TagsModule (e2e) › Suite Pengujian: Asosiasi Tugas-Tag (/api/tags/.../tasks/...) › POST /api/tags/:tagId/tasks/:taskId › [Gagal] Mengaitkan dengan ID tugas atau ID tag yang tidak valid.

    expect(received).toBe(expected) // Object.is equality

    Expected: 404
    Received: 401

      362 |           .post(`/api/tags/${nonExistentId}/tasks/${userATaskId}`)
      363 |           .set('Authorization', `Bearer ${userAToken}`);
    > 364 |         expect(response.status).toBe(HttpStatus.NOT_FOUND);
          |                                 ^
      365 |         expect(response.body.message).toBe('Tag not found');
      366 |
      367 |         // Invalid Task ID

      at Object.<anonymous> (tags.e2e-spec.ts:364:33)

  ● TagsModule (e2e) › Suite Pengujian: Asosiasi Tugas-Tag (/api/tags/.../tasks/...) › POST /api/tags/:tagId/tasks/:taskId › [Gagal] Mengaitkan tag milik Pengguna A dengan tugas milik Pengguna B.

    expect(received).toBe(expected) // Object.is equality

    Expected: 401
    Received: 404

      378 |           .set('Authorization', `Bearer ${userAToken}`);
      379 |
    > 380 |         expect(response.status).toBe(HttpStatus.UNAUTHORIZED);
          |                                 ^
      381 |       });
      382 |
      383 |       it('[Gagal] Mengaitkan tanpa token autentikasi.', async () => {

      at Object.<anonymous> (tags.e2e-spec.ts:380:33)

  ● TagsModule (e2e) › Suite Pengujian: Asosiasi Tugas-Tag (/api/tags/.../tasks/...) › DELETE /api/tags/:tagId/tasks/:taskId › [Sukses] Melepaskan asosiasi tag dari tugas.

    expect(received).toBeDefined()

    Received: undefined

      411 |
      412 |         expect(taskResponse.status).toBe(HttpStatus.OK);
    > 413 |         expect(taskResponse.body.tags).toBeDefined();
          |                                        ^
      414 |         expect(
      415 |           taskResponse.body.tags.some((tag) => tag.id === userATagId),
      416 |         ).toBeFalsy();

      at Object.<anonymous> (tags.e2e-spec.ts:413:40)

Test Suites: 4 failed, 1 passed, 5 total
Tests:       28 failed, 26 passed, 54 total
Snapshots:   0 total
Time:        44.58 s
Ran all test suites.